<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pro Typing Challenge</title>
<style>
    /* ------------------------------------- */
    /* 1. Core Styles & Responsiveness */
    /* ------------------------------------- */
    :root {
        --color-bg: #0f172a;
        --color-card: #1e293b;
        --color-text: #f1f5f9;
        --color-accent: #38bdf8;
        --color-correct: #22c55e;
        --color-wrong: #ef4444;
        --color-word-bg: #334155;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--color-bg);
        color: var(--color-text);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        transition: background-color 0.5s;
        /* Default Theme: Air Space (Subtle Stars/Nebula) */
        background-image: radial-gradient(circle at 10% 20%, #0c1a3b 0%, #000c24 100%);
        animation: subtle-pulse 10s infinite alternate;
    }

    @keyframes subtle-pulse {
        from { transform: scale(1); }
        to { transform: scale(1.02); }
    }

    .card {
        background: var(--color-card);
        padding: 30px;
        border-radius: 16px;
        width: 900px;
        max-width: 95%;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        transition: transform 0.3s ease-out;
    }

    /* ------------------------------------- */
    /* 2. Typography & Layout */
    /* ------------------------------------- */
    h1 {
        text-align: center;
        margin-top: 0;
        color: var(--color-accent);
    }

    .words-container {
        background: var(--color-word-bg);
        padding: 20px;
        border-radius: 10px;
        min-height: 150px;
        margin-bottom: 15px;
        line-height: 1.8;
        font-size: 20px;
        user-select: none;
        overflow: hidden; /* Important for word rendering */
        position: relative;
    }

    .word { margin-right: 10px; display: inline-block; white-space: nowrap; }
    .word.current { background: #475569; border-radius: 4px; padding: 0 4px; }
    
    .char.correct { color: var(--color-correct); }
    .char.wrong { color: var(--color-wrong); background-color: rgba(239, 68, 68, 0.2); border-radius: 2px; }
    
    #input {
        width: 100%;
        padding: 15px;
        border-radius: 8px;
        border: 2px solid var(--color-word-bg);
        font-size: 18px;
        outline: none;
        background: #1e293b;
        color: var(--color-text);
        transition: border-color 0.3s;
    }
    #input:focus { border-color: var(--color-accent); }

    /* ------------------------------------- */
    /* 3. Stats & Buttons */
    /* ------------------------------------- */
    .stats {
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
        font-size: 18px;
        padding: 10px 0;
    }
    .stat-item span { font-weight: bold; color: var(--color-accent); }
    
    button {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        background: var(--color-accent);
        color: var(--color-bg);
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s, transform 0.1s;
    }
    button:hover { background: #0ea5e9; transform: translateY(-1px); }

    /* ------------------------------------- */
    /* 4. Setup & Theming */
    /* ------------------------------------- */
    #setup, #theme-selector, #game-controls {
        padding: 10px 0;
        border-top: 1px solid #334155;
        margin-top: 15px;
    }

    label { display: block; margin-bottom: 8px; font-size: 16px; }
    input[type="text"], input[type="number"], select {
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #475569;
        background: #334155;
        color: var(--color-text);
        width: 100%;
        box-sizing: border-box;
        margin-top: 4px;
    }
    
    .theme-option {
        display: inline-block;
        margin-right: 10px;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 6px;
        border: 2px solid transparent;
        transition: all 0.2s;
        font-size: 14px;
    }
    .theme-option.selected {
        border-color: var(--color-accent);
        background: rgba(56, 189, 248, 0.2);
    }
    
    /* ------------------------------------- */
    /* 5. Pop-up & Modal (for level transition) */
    /* ------------------------------------- */
    .modal {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
    }
    .modal.active { opacity: 1; pointer-events: auto; }

    .modal-content {
        background: var(--color-card);
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        animation: scale-up 0.3s ease-out;
    }
    @keyframes scale-up { from { transform: scale(0.8); } to { transform: scale(1); } }
    .modal-content h2 { color: var(--color-correct); }

    /* ------------------------------------- */
    /* 6. Leaderboard (Styling kept simple) */
    /* ------------------------------------- */
    #leaderboard {
        margin-top: 20px;
        background: var(--color-word-bg);
        padding: 15px;
        border-radius: 10px;
    }
    #leaderboard h2 { margin: 0 0 10px 0; color: var(--color-accent); }
    #leaderboard ol { padding-left: 20px; }
    
</style>
</head>
<body>
<div class="card">
    <h1><span id="game-title">Pro Typing Challenge</span></h1>
    
    <div id="level-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">Level Complete!</h2>
            <p id="modal-message"></p>
            <button id="continue-btn" class="modal-btn">Continue to Next Level</button>
            <button id="stop-btn" class="modal-btn" style="background: var(--color-wrong); margin-left: 10px;">Stop Game</button>
        </div>
    </div>

    <div id="setup">
        <label>Player Name: <input type="text" id="playerName" value="Guest"></label>
        <label>Select Level: 
            <select id="difficulty">
                <option value="easy">Easy (Time/Word: 4s)</option>
                <option value="medium">Medium (Time/Word: 3s)</option>
                <option value="hard">Hard (Time/Word: 2s)</option>
                <option value="expert">Expert (Time/Word: 1s)</option>
            </select>
        </label>
        
        <div id="theme-selector">
            <strong>Select Theme:</strong>
            <span class="theme-option selected" data-theme="air-space">Air Space</span>
            <span class="theme-option" data-theme="sea">Sea</span>
            <span class="theme-option" data-theme="pink-panther">Pink Panther</span>
            <span class="theme-option" data-theme="sky">Sky</span>
            <span class="theme-option" data-theme="robots">Robots</span>
        </div>

        <button id="startBtn" style="width: 100%; margin-top: 15px;">Start Challenge</button>
    </div>

    <div id="game" style="display:none;">
        <div class="stats">
            <div class="stat-item">Level: <span id="current-level">Easy</span></div>
            <div class="stat-item">Time Left: <span id="timer">0</span>s</div>
            <div class="stat-item">WPM: <span id="wpm">0</span></div>
            <div class="stat-item">Accuracy: <span id="accuracy">100%</span></div>
        </div>

        <div class="words-container" id="words"></div>
        <input id="input" type="text" placeholder="Type here..." disabled autocomplete="off">
        
        <div id="result" style="margin-top: 15px;"></div>
        <div id="game-controls" style="text-align: center;">
            <button id="restartBtn" style="display:none;">Restart Game</button>
        </div>
    </div>

    <div id="leaderboard">
        <h2>üèÜ Top WPM Scores</h2>
        <ol id="leaderboardList"></ol>
    </div>
</div>

<script>
(() => {
    // -------------------------------------
    // MODULE 1: CONFIGURATION & DATA
    // -------------------------------------
    const CONFIG = {
        LEVELS: {
            easy: { words: "the quick brown fox jumps over lazy dog practice perfect typing speed game improve coding javascript html css challenge victory".split(" ").sort(() => Math.random() - 0.5), timePerWord: 4 }, // 25 words
            medium: { words: "algorithm framework application asynchronous modular developer backend frontend database repository component variable function scope promise async await closure object array class inherit method polymorphism abstraction".split(" ").sort(() => Math.random() - 0.5), timePerWord: 3 }, // 30 words
            hard: { words: "unpredictable bureaucracy conscientious discombobulate entrepreneurship exhilaration idiosyncrasy mischievous paraphernalia picturesque reconnaissance silhouette susceptibility ubiquitous vernacular willingness yacht zephyr zenith".split(" ").sort(() => Math.random() - 0.5), timePerWord: 2 }, // 26 words
            expert: { words: "juxtaposition onomatopoeia acquiesce paradigm clandestine dichotomy ephemeral harbinger intrepid mellifluous paucity rhetoric serendipity taciturn vivacious wisp xylophone yolk zeitgeist zizz zany zaftig zillion zither zygote".split(" ").sort(() => Math.random() - 0.5), timePerWord: 1 }, // 26 words
        },
        WORD_COUNT: 30, // Minimum words per level
        THEMES: {
            'air-space': { bg: 'radial-gradient(circle at 10% 20%, #0c1a3b 0%, #000c24 100%)', text: '#f1f5f9', accent: '#38bdf8' },
            'sea': { bg: 'linear-gradient(to right, #00c6ff, #0072ff)', text: '#ffffff', accent: '#ffea00' },
            // Add other themes here (Pink Panther, Sky, Robots)
        },
        SOUNDS: {
            PASS_LEVEL: 'https://cdn.jsdelivr.net/gh/Tonejs/Tone.js@master/examples/audio/pascal.mp3', // Placeholder
            FAIL_WORD: 'https://cdn.jsdelivr.net/gh/Tonejs/Tone.js@master/examples/audio/chord.mp3'   // Placeholder
        }
    };
    
    // -------------------------------------
    // MODULE 2: STATE MANAGEMENT
    // -------------------------------------
    let gameState = {
        playerName: "Guest",
        currentLevel: 'easy',
        wordsArray: [],
        currentIndex: 0,
        correctChars: 0,
        totalTyped: 0,
        startTime: null,
        timerId: null,
        wordTimerId: null,
        timeLeft: 0,
        levelTimeLimit: 0,
        isGameOver: true,
    };

    // -------------------------------------
    // MODULE 3: DOM ELEMENTS & UTILITIES
    // -------------------------------------
    const DOM = {
        wordsEl: document.getElementById('words'),
        inputEl: document.getElementById('input'),
        timerEl: document.getElementById('timer'),
        wpmEl: document.getElementById('wpm'),
        accuracyEl: document.getElementById('accuracy'),
        resultEl: document.getElementById('result'),
        startBtn: document.getElementById('startBtn'),
        restartBtn: document.getElementById('restartBtn'),
        leaderboardList: document.getElementById('leaderboardList'),
        setupScreen: document.getElementById('setup'),
        gameScreen: document.getElementById('game'),
        playerInput: document.getElementById('playerName'),
        levelSelect: document.getElementById('difficulty'),
        currentLevelEl: document.getElementById('current-level'),
        levelModal: document.getElementById('level-modal'),
        modalTitle: document.getElementById('modal-title'),
        modalMessage: document.getElementById('modal-message'),
        continueBtn: document.getElementById('continue-btn'),
        stopBtn: document.getElementById('stop-btn'),
        themeOptions: document.querySelectorAll('.theme-option'),
    };
    
    const util = {
        playSound: (type) => {
            if (CONFIG.SOUNDS[type]) {
                new Audio(CONFIG.SOUNDS[type]).play().catch(() => {}); // Prevent console errors
            }
        },
        // Retrieves the next level key based on the current one
        getNextLevel: (currentKey) => {
            const keys = Object.keys(CONFIG.LEVELS);
            const currentIndex = keys.indexOf(currentKey);
            return currentIndex < keys.length - 1 ? keys[currentIndex + 1] : null;
        },
    };

    // -------------------------------------
    // MODULE 4: RENDERING & UI UPDATES
    // -------------------------------------
    
    // Renders the current words array to the screen
    function renderWords() {
        DOM.wordsEl.innerHTML = '';
        const wordsToRender = gameState.wordsArray.slice(gameState.currentIndex);

        wordsToRender.forEach((w, i) => {
            const span = document.createElement('span');
            // Only the first visible word is the current one
            span.className = 'word' + (i === 0 ? ' current' : '');
            [...w].forEach(ch => {
                const c = document.createElement('span');
                c.className = 'char';
                c.textContent = ch;
                span.appendChild(c);
            });
            DOM.wordsEl.appendChild(span);
            DOM.wordsEl.append(" ");
        });
        // Auto-scroll logic (scroll to the current word)
        const currentWordEl = DOM.wordsEl.querySelector('.word.current');
        if (currentWordEl) {
            currentWordEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    }
    
    // Updates WPM, Accuracy, and Timer in real-time
    function updateStats(onInput = false) {
        const elapsedSec = Math.floor((Date.now() - gameState.startTime) / 1000);
        const elapsedMin = elapsedSec / 60;
        
        // Calculate WPM (Net WPM: Correct Chars / 5 / Time)
        const wpm = Math.round((gameState.correctChars / 5) / Math.max(elapsedMin, 0.01));
        // Calculate Accuracy
        const acc = Math.round((gameState.correctChars / Math.max(gameState.totalTyped, 1)) * 100);

        DOM.wpmEl.textContent = wpm;
        DOM.accuracyEl.textContent = acc + "%";

        if (!onInput) {
             // Only update timer on the interval
            gameState.timeLeft--;
            DOM.timerEl.textContent = gameState.timeLeft;
            
            // Check for individual word timeout
            if (gameState.timeLeft <= 0) {
                handleWordMiss();
            }
        }
    }

    // Applies the selected theme to the body and variables
    function applyTheme(themeKey) {
        const theme = CONFIG.THEMES[themeKey];
        if (!theme) return;

        document.documentElement.style.setProperty('--color-bg', theme.bg.includes('gradient') ? CONFIG.THEMES['air-space'].bg : theme.bg);
        document.documentElement.style.setProperty('--color-text', theme.text);
        document.documentElement.style.setProperty('--color-accent', theme.accent);
        document.body.style.backgroundImage = theme.bg.includes('gradient') ? theme.bg : `url(${theme.bg})`;
        
        DOM.themeOptions.forEach(opt => opt.classList.remove('selected'));
        document.querySelector(`.theme-option[data-theme="${themeKey}"]`).classList.add('selected');
        
        // NOTE: For a production app, the background-image should be applied to the body, 
        // and background-color should be used for the variable fallback.
    }
    
    // -------------------------------------
    // MODULE 5: GAME FLOW & LOGIC
    // -------------------------------------

    // Resets game state and UI to start a new level or game
    function resetLevel(levelKey) {
        const levelData = CONFIG.LEVELS[levelKey];
        
        // Populate words array and set current level
        gameState.wordsArray = levelData.words.slice(0, CONFIG.WORD_COUNT);
        gameState.currentLevel = levelKey;
        gameState.currentIndex = 0;
        gameState.correctChars = 0;
        gameState.totalTyped = 0;
        gameState.isGameOver = false;
        
        // Total time for the level: words * timePerWord
        gameState.levelTimeLimit = gameState.wordsArray.length * levelData.timePerWord;
        gameState.timeLeft = gameState.levelTimeLimit;

        clearInterval(gameState.timerId);
        clearInterval(gameState.wordTimerId);

        DOM.inputEl.value = '';
        DOM.inputEl.disabled = false;
        DOM.inputEl.focus();
        DOM.resultEl.innerHTML = '';
        DOM.currentLevelEl.textContent = levelKey.charAt(0).toUpperCase() + levelKey.slice(1);
    }
    
    // Starts the main game timer (one tick per second)
    function startTimer() {
        gameState.startTime = Date.now();
        // Start the timer to check word time limit (time per word)
        gameState.timerId = setInterval(() => {
            updateStats();
            if (gameState.isGameOver) clearInterval(gameState.timerId);
        }, 1000);
    }

    // Initiates the game from the setup screen
    function startGame() {
        gameState.playerName = DOM.playerInput.value.trim() || "Guest";
        const selectedLevel = DOM.levelSelect.value;

        DOM.setupScreen.style.display = 'none';
        DOM.gameScreen.style.display = 'block';

        resetLevel(selectedLevel);
        renderWords();
        startTimer();
    }
    
    // Handles the completion of the game or level
    function finishGame(isLevelComplete = false) {
        clearInterval(gameState.timerId);
        gameState.isGameOver = true;
        DOM.inputEl.disabled = true;

        const elapsedMin = (Date.now() - gameState.startTime) / 1000 / 60;
        const finalWPM = Math.round((gameState.correctChars / 5) / Math.max(elapsedMin, 0.01));
        const finalAcc = Math.round((gameState.correctChars / Math.max(gameState.totalTyped, 1)) * 100);

        updateLeaderboard(gameState.playerName, finalWPM);

        if (isLevelComplete) {
            util.playSound('PASS_LEVEL');
            showLevelModal(finalWPM, finalAcc);
        } else {
            // General Game Over (Failure)
            util.playSound('FAIL_WORD');
            DOM.resultEl.innerHTML = `<p class="lose">Game Over, ${gameState.playerName}! You failed to complete all levels. Final WPM: ${finalWPM} | Accuracy: ${finalAcc}%</p>`;
            DOM.restartBtn.style.display = 'inline-block';
        }
    }

    // Shows the modal for level transition
    function showLevelModal(wpm, acc) {
        const nextLevel = util.getNextLevel(gameState.currentLevel);
        const nextLevelName = nextLevel ? nextLevel.charAt(0).toUpperCase() + nextLevel.slice(1) : "None (Expert Level Complete!)";

        DOM.modalTitle.textContent = nextLevel ? `Level ${gameState.currentLevel.toUpperCase()} Complete!` : "CHALLENGE CONQUERED!";
        DOM.modalMessage.innerHTML = `Your WPM: ${wpm} | Accuracy: ${acc}%<br>Next Level: ${nextLevelName}`;
        
        DOM.continueBtn.style.display = nextLevel ? 'inline-block' : 'none';

        // Set listener for modal buttons
        DOM.continueBtn.onclick = () => {
            DOM.levelModal.classList.remove('active');
            if (nextLevel) {
                resetLevel(nextLevel);
                renderWords();
                startTimer();
            }
        };
        
        DOM.stopBtn.onclick = () => {
            DOM.levelModal.classList.remove('active');
            // Transition back to setup or show final results screen
            DOM.gameScreen.style.display = 'none';
            DOM.setupScreen.style.display = 'block';
            DOM.restartBtn.style.display = 'none';
        };

        DOM.levelModal.classList.add('active');
    }

    // Handles the core typing logic
    function handleInput() {
        const val = DOM.inputEl.value;
        const curWord = gameState.wordsArray[gameState.currentIndex] || "";
        const charSpans = DOM.wordsEl.querySelectorAll('.word.current .char');

        gameState.totalTyped++;

        // Strict Error Handling: If *any* key is wrong, immediately mark word as missed and skip
        let isMistake = false;
        for (let i = 0; i < val.length; i++) {
            if (val[i] !== curWord[i]) {
                isMistake = true;
                break;
            }
        }

        if (isMistake) {
            // Requirement: If a player types a wrong letter, immediately skip to the next word.
            handleWordMiss(true);
            util.playSound('FAIL_WORD');
            return;
        }
        
        // Live feedback for correct characters
        gameState.correctChars = 0; // Recalculate based on current state
        for (let i = 0; i < charSpans.length; i++) {
            charSpans[i].classList.remove('correct', 'wrong');
            if (val[i]) {
                if (val[i] === curWord[i]) {
                    charSpans[i].classList.add('correct');
                    gameState.correctChars++;
                } else {
                    // This case should ideally be caught by the isMistake check above,
                    // but is kept for robustness in case of browser/timing quirks.
                    charSpans[i].classList.add('wrong');
                }
            }
        }
        
        // Update WPM and Accuracy on every input event
        updateStats(true); 

        // Word Completion
        if (val === curWord) {
            gameState.currentIndex++;
            DOM.inputEl.value = '';

            // Level Complete check
            if (gameState.currentIndex >= gameState.wordsArray.length) {
                finishGame(true); // isLevelComplete = true
            } else {
                // Adjust remaining time for next word
                const timeForNextWord = CONFIG.LEVELS[gameState.currentLevel].timePerWord;
                gameState.timeLeft += timeForNextWord; 
                renderWords();
            }
        }
    }

    // Handles a missed word due to time running out or a typing error
    function handleWordMiss(typingError = false) {
        const curWord = gameState.wordsArray[gameState.currentIndex] || "";
        const penaltyChars = curWord.length;

        // Apply a penalty to totalTyped for words missed by time
        if (!typingError) {
             gameState.totalTyped += penaltyChars;
        }

        gameState.currentIndex++;
        DOM.inputEl.value = '';
        util.playSound('FAIL_WORD');

        if (gameState.currentIndex >= gameState.wordsArray.length) {
            finishGame(false); // isLevelComplete = false (failed the level/game)
        } else {
            // Reset time for the new word
            const timeForNextWord = CONFIG.LEVELS[gameState.currentLevel].timePerWord;
            gameState.timeLeft += timeForNextWord;
            renderWords();
        }
    }
    
    // -------------------------------------
    // MODULE 6: LEADERBOARD
    // -------------------------------------
    
    // Stores and sorts scores
    function updateLeaderboard(name, wpm) {
        let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
        
        // Store the name, WPM, and the level achieved
        leaderboard.push({ 
            name, 
            wpm, 
            level: gameState.currentLevel.toUpperCase(),
            timestamp: new Date().toLocaleString()
        });
        
        // Sort high to low
        leaderboard.sort((a,b) => b.wpm - a.wpm);
        // keep top 10
        leaderboard = leaderboard.slice(0, 10);
        localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
        renderLeaderboard();
    }

    // Renders scores to the list
    function renderLeaderboard() {
        const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
        DOM.leaderboardList.innerHTML = '';
        if (leaderboard.length === 0) {
            DOM.leaderboardList.innerHTML = '<li>No scores yet!</li>';
            return;
        }
        leaderboard.forEach(p => {
            const li = document.createElement('li');
            li.textContent = `${p.name} (${p.level}) - ${p.wpm} WPM`;
            DOM.leaderboardList.appendChild(li);
        });
    }

    // -------------------------------------
    // MODULE 7: EVENT LISTENERS
    // -------------------------------------
    
    // Initialize listeners
    function initListeners() {
        DOM.startBtn.addEventListener('click', startGame);
        DOM.restartBtn.addEventListener('click', () => {
             // Go back to setup to select level/name
            DOM.gameScreen.style.display = 'none';
            DOM.setupScreen.style.display = 'block';
            DOM.restartBtn.style.display = 'none';
        });

        // Use 'input' for real-time validation and 'keydown' to prevent paste/control keys
        DOM.inputEl.addEventListener('input', handleInput);
        DOM.inputEl.addEventListener('keydown', (e) => {
             // Prevent space at start of word and control keys
            if (e.key === ' ' && DOM.inputEl.value.length === 0) {
                e.preventDefault();
            }
        });
        
        // Theme selection
        DOM.themeOptions.forEach(opt => {
            opt.addEventListener('click', (e) => {
                const themeKey = e.target.getAttribute('data-theme');
                applyTheme(themeKey);
            });
        });

        // Initialize theme and leaderboard on load
        applyTheme('air-space');
        renderLeaderboard();
    }

    // Start the application
    initListeners();

})();
</script>
</body>
</html>
